<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QR Code Generator Pro - ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏ü‡∏£‡∏µ</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
:root {
  --primary: #112D4E;
  --primary-light: #3F72AF;
  --secondary: #DBE2EF;
  --background: #F9F7F7;
  --success: #4CAF50;
  --warning: #FF9800;
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --text-light: #999999;
  --border-color: #ddd;
  --shadow-sm: rgba(17, 45, 78, 0.08);
  --shadow-md: rgba(17, 45, 78, 0.12);
  --shadow-lg: rgba(17, 45, 78, 0.16);
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;
  --space-2xl: 48px;
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 20px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Sarabun', system-ui, sans-serif;
  background: var(--background);
  color: var(--text-primary);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

.site-header {
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  padding: var(--space-xl) var(--space-md);
  box-shadow: 0 4px 20px var(--shadow-md);
  color: white;
}

.header-content {
  max-width: 1200px;
  margin: 0 auto;
  text-align: center;
}

.brand {
  font-size: 36px;
  font-weight: 700;
  margin-bottom: var(--space-sm);
  text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.tag {
  font-size: 16px;
  opacity: 0.95;
}

.status-badge {
  display: inline-block;
  margin-top: var(--space-md);
  padding: var(--space-sm) var(--space-md);
  background: rgba(255,255,255,0.2);
  border-radius: 20px;
  font-size: 14px;
  backdrop-filter: blur(10px);
}

.status-badge.online { background: rgba(76, 175, 80, 0.3); }
.status-badge.offline { background: rgba(244, 67, 54, 0.3); }

.container {
  max-width: 1200px;
  margin: var(--space-xl) auto;
  padding: 0 var(--space-md);
}

.tabs {
  display: flex;
  gap: var(--space-md);
  margin-bottom: var(--space-xl);
  background: white;
  padding: var(--space-sm);
  border-radius: var(--radius-lg);
  box-shadow: 0 2px 12px var(--shadow-sm);
  overflow-x: auto;
}

.tab {
  flex: 1;
  min-width: 150px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  padding: var(--space-md);
  border: none;
  background: transparent;
  color: var(--text-secondary);
  font-weight: 500;
  font-size: 15px;
  cursor: pointer;
  border-radius: var(--radius-md);
  transition: all 0.3s ease;
  white-space: nowrap;
}

.tab:hover:not(.active) {
  background: var(--secondary);
  color: var(--primary);
}

.tab.active {
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  color: white;
  box-shadow: 0 4px 12px var(--shadow-md);
}

.tab-icon { width: 20px; height: 20px; }

.content-area {
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: var(--space-xl);
  align-items: start;
}

@media (max-width: 968px) {
  .content-area { grid-template-columns: 1fr; }
  .preview-panel { order: -1; }
}

.card {
  background: white;
  border-radius: var(--radius-xl);
  padding: var(--space-xl);
  box-shadow: 0 4px 20px var(--shadow-sm);
  margin-bottom: var(--space-lg);
}

.section-title {
  color: var(--primary);
  font-size: 24px;
  font-weight: 600;
  margin-bottom: var(--space-md);
}

.help-text {
  color: var(--text-secondary);
  font-size: 15px;
  margin-bottom: var(--space-lg);
}

.input-group {
  margin-bottom: var(--space-lg);
}

.input-group label {
  display: block;
  margin-bottom: var(--space-sm);
  font-weight: 500;
  color: var(--text-primary);
}

.input-field {
  width: 100%;
  padding: 14px 16px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-md);
  font-size: 16px;
  font-family: inherit;
  transition: all 0.3s ease;
}

.input-field:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 4px rgba(63, 114, 175, 0.1);
}

.settings-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-md);
  margin-bottom: var(--space-lg);
}

.color-picker {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  padding: var(--space-sm);
  background: var(--background);
  border-radius: var(--radius-md);
  border: 2px solid var(--border-color);
}

input[type="color"] {
  width: 50px;
  height: 50px;
  border: 3px solid white;
  border-radius: var(--radius-sm);
  cursor: pointer;
  box-shadow: 0 2px 8px var(--shadow-sm);
}

.range-group {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  padding: var(--space-md);
  background: var(--background);
  border-radius: var(--radius-md);
}

input[type="range"] {
  flex: 1;
  height: 8px;
  background: var(--secondary);
  border-radius: 4px;
}

.file-input {
  display: block;
  width: 100%;
  padding: var(--space-md);
  border: 2px dashed var(--border-color);
  border-radius: var(--radius-md);
  background: var(--background);
  cursor: pointer;
  transition: all 0.3s ease;
}

.file-input:hover {
  border-color: var(--primary-light);
  background: white;
}

.file-info {
  margin-top: var(--space-md);
  padding: var(--space-md);
  background: var(--secondary);
  border-radius: var(--radius-sm);
  font-size: 14px;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  padding: var(--space-md) var(--space-xl);
  border: none;
  border-radius: var(--radius-md);
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: inherit;
}

.btn-large {
  width: 100%;
  padding: 18px;
  font-size: 18px;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  color: white;
  box-shadow: 0 4px 16px var(--shadow-md);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px var(--shadow-lg);
}

.btn-primary:disabled {
  background: var(--border-color);
  cursor: not-allowed;
  transform: none;
}

.preview-card {
  background: white;
  border-radius: var(--radius-xl);
  padding: var(--space-xl);
  box-shadow: 0 4px 20px var(--shadow-sm);
  position: sticky;
  top: var(--space-lg);
}

.preview-title {
  color: var(--primary);
  font-size: 20px;
  font-weight: 600;
  margin-bottom: var(--space-lg);
  text-align: center;
}

.empty-state {
  text-align: center;
  padding: var(--space-2xl);
  color: var(--text-secondary);
}

.qr-result {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-lg);
}

.qr-result img {
  max-width: 100%;
  border-radius: var(--radius-md);
  box-shadow: 0 4px 20px var(--shadow-md);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
  animation: fadeIn 0.4s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.history-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-md);
  background: var(--background);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-sm);
}

.history-item:hover {
  background: var(--secondary);
}

.batch-input {
  min-height: 150px;
  resize: vertical;
}

footer {
  text-align: center;
  padding: var(--space-xl);
  color: var(--text-secondary);
  margin-top: var(--space-2xl);
  background: white;
  border-top: 1px solid var(--secondary);
}

@media (max-width: 768px) {
  .settings-grid { grid-template-columns: 1fr; }
  .tabs { flex-direction: column; }
}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-content">
      <h1 class="brand">üéØ QR Code Generator Pro</h1>
    <p class="tag">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á PDF</p>
      <div id="status-badge" class="status-badge">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
    </div>
  </header>

  <main class="container">
    <nav class="tabs">
      <button class="tab active" data-tab="text-qr">
        <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z"/>
        </svg>
        ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏•‡∏¥‡∏á‡∏Å‡πå
      </button>
      <button class="tab" data-tab="file-qr">
        <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
        </svg>
        ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
      </button>
      <button class="tab" data-tab="scan-qr">
        <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9.5 6.5v3h-3v-3h3M11 5H5v6h6V5zm-1.5 9.5v3h-3v-3h3M11 13H5v6h6v-6zm6.5-6.5v3h-3v-3h3M19 5h-6v6h6V5zm-6 8h1.5v1.5H13V13zm1.5 1.5H16V16h-1.5v-1.5zM16 13h1.5v1.5H16V13zm-3 3h1.5v1.5H13V16zm1.5 1.5H16V19h-1.5v-1.5zM16 16h1.5v1.5H16V16zm1.5-1.5H19V16h-1.5v-1.5zm0 3H19V19h-1.5v-1.5zM22 7h-2V4h-3V2h5v5zm0 15v-5h-2v3h-3v2h5zM2 22h5v-2H4v-3H2v5zM2 2v5h2V4h3V2H2z"/>
        </svg>
        ‡∏™‡πÅ‡∏Å‡∏ô QR
      </button>
      <button class="tab" data-tab="batch-qr">
        <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 16h8v2H8zm0-4h8v2H8zm6-10H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
        </svg>
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      </button>
    </nav>

    <div class="content-area">
      <!-- Tab 1: Text/URL -->
      <div>
        <section id="text-qr" class="tab-content active">
          <div class="card">
            <h2 class="section-title">üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå</h2>
            <div class="input-group">
              <label for="text">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠ URL</label>
              <input type="text" id="text" class="input-field" placeholder="https://example.com ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏î‡πÜ" />
            </div>
            
            <div class="settings-grid">
              <div class="input-group">
                <label for="fg-color">‡∏™‡∏µ QR Code</label>
                <div class="color-picker">
                  <input type="color" id="fg-color" value="#000000">
                  <span id="fg-label">‡∏™‡∏µ‡∏î‡∏≥</span>
                </div>
              </div>
              <div class="input-group">
                <label for="bg-color">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</label>
                <div class="color-picker">
                  <input type="color" id="bg-color" value="#ffffff">
                  <span id="bg-label">‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß</span>
                </div>
              </div>
            </div>

            <div class="input-group">
              <label for="qr-size">‡∏Ç‡∏ô‡∏≤‡∏î</label>
              <div class="range-group">
                <input type="range" id="qr-size" min="200" max="500" value="300">
                <span id="size-value">300px</span>
              </div>
            </div>

            <div class="input-group">
              <label for="center-image">‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
              <input type="file" id="center-image" class="file-input" accept="image/*">
            </div>

            <button class="btn btn-primary btn-large" onclick="generateQR()">‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</button>
          </div>
        </section>

        <!-- Tab 2: File Upload -->
        <section id="file-qr" class="tab-content">
          <div class="card">
            <h2 class="section-title">üìÅ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</h2>
            <p class="help-text">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö PDF, Word, Excel, PowerPoint, ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û, ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50MB)</p>
            
            <div class="input-group">
              <label for="file">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</label>
              <input type="file" id="file" class="file-input">
              <div id="file-info" class="file-info" style="display:none;"></div>
            </div>

            <div class="settings-grid">
              <div class="input-group">
                <label for="fg-color-file">‡∏™‡∏µ QR Code</label>
                <div class="color-picker">
                  <input type="color" id="fg-color-file" value="#000000">
                  <span id="fg-label-file">‡∏™‡∏µ‡∏î‡∏≥</span>
                </div>
              </div>
              <div class="input-group">
                <label for="bg-color-file">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</label>
                <div class="color-picker">
                  <input type="color" id="bg-color-file" value="#ffffff">
                  <span id="bg-label-file">‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß</span>
                </div>
              </div>
            </div>

            <div class="input-group">
              <label for="qr-size-file">‡∏Ç‡∏ô‡∏≤‡∏î</label>
              <div class="range-group">
                <input type="range" id="qr-size-file" min="200" max="500" value="300">
                <span id="size-value-file">300px</span>
              </div>
            </div>

            <div class="input-group">
              <label for="center-image-file">‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
              <input type="file" id="center-image-file" class="file-input" accept="image/*">
            </div>

            <button class="btn btn-primary btn-large" onclick="uploadAndGenerate()">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á QR</button>
          </div>
        </section>

        <!-- Tab 3: Scan QR -->
        <section id="scan-qr" class="tab-content">
          <div class="card">
            <h2 class="section-title">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR Code</h2>
            <p class="help-text">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            
            <div class="input-group">
              <label for="scan-image">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û QR Code</label>
              <input type="file" id="scan-image" class="file-input" accept="image/*">
            </div>

            <button class="btn btn-primary btn-large" onclick="scanQR()">‡∏™‡πÅ‡∏Å‡∏ô QR Code</button>

            <div id="scan-result" style="margin-top: 20px;"></div>
          </div>
        </section>

        <!-- Tab 4: Batch -->
        <section id="batch-qr" class="tab-content">
          <div class="card">
            <h2 class="section-title">üìã ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô</h2>
            <p class="help-text">‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô</p>
            
            <div class="input-group">
              <label for="batch-text">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÅ‡∏¢‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà)</label>
              <textarea id="batch-text" class="input-field batch-input" placeholder="https://example.com/product1
https://example.com/product2
https://example.com/product3"></textarea>
            </div>

            <button class="btn btn-primary btn-large" onclick="generateBatch()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          </div>
        </section>
      </div>

      <!-- Preview Panel -->
      <aside class="preview-panel">
        <div class="preview-card">
          <h3 class="preview-title">üéØ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h3>
          <div id="result">
            <div class="empty-state">
              <p>QR Code ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer>
    &copy; 2025 ‚Ä¢ QR Code Generator Pro ‚Ä¢ Made with ‚ù§Ô∏è
  </footer>

  <script>
const BACKEND_URL = 'https://still-beverlee-backend-qrcode-version3-b572bb8c.koyeb.app/';
let centerImageBase64 = null;
let centerImageBase64File = null;

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Backend
async function checkStatus() {
  const badge = document.getElementById('status-badge');
  try {
    const res = await fetch(`${BACKEND_URL}/health`);
    if (res.ok) {
      badge.textContent = '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
      badge.className = 'status-badge online';
    } else {
      throw new Error('Connection failed');
    }
  } catch (e) {
    badge.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Backend';
    badge.className = 'status-badge offline';
  }
}

// Setup tabs
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

// Setup color pickers
function setupColorPicker(colorId, labelId) {
  const input = document.getElementById(colorId);
  const label = document.getElementById(labelId);
  input.addEventListener('change', (e) => {
    const colors = {
      '#000000': '‡∏™‡∏µ‡∏î‡∏≥', '#ffffff': '‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß', '#ff0000': '‡∏™‡∏µ‡πÅ‡∏î‡∏á',
      '#00ff00': '‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', '#0000ff': '‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô'
    };
    label.textContent = colors[e.target.value] || e.target.value;
  });
}

setupColorPicker('fg-color', 'fg-label');
setupColorPicker('bg-color', 'bg-label');
setupColorPicker('fg-color-file', 'fg-label-file');
setupColorPicker('bg-color-file', 'bg-label-file');

// Setup range sliders
document.getElementById('qr-size').oninput = (e) => {
  document.getElementById('size-value').textContent = e.target.value + 'px';
};
document.getElementById('qr-size-file').oninput = (e) => {
  document.getElementById('size-value-file').textContent = e.target.value + 'px';
};

// Setup center images
document.getElementById('center-image').onchange = (e) => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (ev) => { centerImageBase64 = ev.target.result; };
    reader.readAsDataURL(file);
  }
};

document.getElementById('center-image-file').onchange = (e) => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (ev) => { centerImageBase64File = ev.target.result; };
    reader.readAsDataURL(file);
  }
};

// Generate QR from text
async function generateQR() {
  const text = document.getElementById('text').value.trim();
  if (!text) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°');

  const result = document.getElementById('result');
  result.innerHTML = '<p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...</p>';

  try {
    const res = await fetch(`${BACKEND_URL}/generate`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        text,
        fg: document.getElementById('fg-color').value,
        bg: document.getElementById('bg-color').value,
        size: parseInt(document.getElementById('qr-size').value),
        center_image: centerImageBase64
      })
    });

    if (res.ok) {
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      result.innerHTML = `
        <div class="qr-result">
          <img src="${url}" alt="QR Code">
          <button class="btn btn-primary" onclick="downloadQR('${url}', 'qrcode')">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
        </div>
      `;
      saveHistory('text', text);
    } else {
      const err = await res.json();
      alert('Error: ' + err.error);
    }
  } catch (e) {
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
  }
}

// Upload and generate QR
async function uploadAndGenerate() {
  const fileInput = document.getElementById('file');
  const file = fileInput.files[0];
  if (!file) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå');

  const result = document.getElementById('result');
  const info = document.getElementById('file-info');
  info.style.display = 'block';
  info.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...';
  result.innerHTML = '<p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</p>';

  try {
    const fd = new FormData();
    fd.append('file', file);

    const uploadRes = await fetch(`${BACKEND_URL}/upload`, {
      method: 'POST',
      body: fd
    });

    const uploadData = await uploadRes.json();
    if (!uploadRes.ok) throw new Error(uploadData.error);

    const fileUrl = BACKEND_URL + uploadData.url;
    info.textContent = '‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + uploadData.filename;

    const qrRes = await fetch(`${BACKEND_URL}/generate-file-qr`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        file_url: fileUrl,
        fg: document.getElementById('fg-color-file').value,
        bg: document.getElementById('bg-color-file').value,
        size: parseInt(document.getElementById('qr-size-file').value),
        center_image: centerImageBase64File
      })
    });

    if (qrRes.ok) {
      const blob = await qrRes.blob();
      const url = URL.createObjectURL(blob);
      result.innerHTML = `
        <div class="qr-result">
          <img src="${url}" alt="QR Code">
          <button class="btn btn-primary" onclick="downloadQR('${url}', 'qrcode-file')">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
          <button class="btn btn-primary" onclick="copyText('${fileUrl}')">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
        </div>
      `;
      saveHistory('file', uploadData.filename);
    }
  } catch (e) {
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
    info.textContent = '';
  }
}

// Scan QR Code
async function scanQR() {
  const fileInput = document.getElementById('scan-image');
  const file = fileInput.files[0];
  if (!file) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û');

  const result = document.getElementById('scan-result');
  result.innerHTML = '<p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô...</p>';

  const reader = new FileReader();
  reader.onload = async (e) => {
    try {
      const res = await fetch(`${BACKEND_URL}/scan-qr`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ image: e.target.result })
      });

      if (res.ok) {
        const data = await res.json();
        if (data.results && data.results.length > 0) {
          result.innerHTML = data.results.map(r => `
            <div style="padding: 15px; background: #e8f5e9; border-radius: 8px; margin-top: 10px;">
              <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${r.type}<br>
              <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong> ${r.data}
            </div>
          `).join('');
        } else {
          result.innerHTML = '<p>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö QR Code ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>';
        }
      } else {
        const err = await res.json();
        result.innerHTML = '<p>‚ùå ' + err.error + '</p>';
      }
    } catch (e) {
      result.innerHTML = '<p>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message + '</p>';
    }
  };
  reader.readAsDataURL(file);
}

// Generate batch QR codes
async function generateBatch() {
  const text = document.getElementById('batch-text').value.trim();
  if (!text) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');

  const lines = text.split('\n').filter(l => l.trim());
  if (lines.length === 0) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');

  const result = document.getElementById('result');
  result.innerHTML = '<p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á ' + lines.length + ' QR Codes...</p>';

  const qrCodes = [];
  for (let i = 0; i < lines.length; i++) {
    try {
      const res = await fetch(`${BACKEND_URL}/generate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          text: lines[i],
          fg: '#000000',
          bg: '#ffffff',
          size: 300
        })
      });

      if (res.ok) {
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        qrCodes.push({ text: lines[i], url });
      }
    } catch (e) {
      console.error('Error generating QR for:', lines[i], e);
    }
  }

  result.innerHTML = `
    <div style="max-height: 500px; overflow-y: auto;">
      ${qrCodes.map((qr, i) => `
        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px; margin-bottom: 10px;">
          <p style="font-size: 14px; margin-bottom: 10px;"><strong>#${i + 1}:</strong> ${qr.text}</p>
          <img src="${qr.url}" style="width: 150px; border-radius: 8px;">
          <button class="btn btn-primary" style="margin-top: 10px; font-size: 14px;" onclick="downloadQR('${qr.url}', 'qrcode-${i + 1}')">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
        </div>
      `).join('')}
    </div>
  `;
}

// Download QR Code
function downloadQR(url, filename) {
  const a = document.createElement('a');
  a.href = url;
  a.download = filename + '.png';
  a.click();
}

// Copy text to clipboard
async function copyText(text) {
  try {
    await navigator.clipboard.writeText(text);
    alert('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß');
  } catch {
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    alert('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß');
  }
}

// Save to history
function saveHistory(type, data) {
  try {
    const history = JSON.parse(localStorage.getItem('qr_history') || '[]');
    history.unshift({
      type,
      data,
      timestamp: new Date().toISOString()
    });
    localStorage.setItem('qr_history', JSON.stringify(history.slice(0, 50)));
  } catch (e) {
    console.error('Cannot save history:', e);
  }
}

// Initialize
checkStatus();
  </script>
</body>
</html>